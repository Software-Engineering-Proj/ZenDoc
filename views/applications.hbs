<!DOCTYPE html>
<html>
<head>
	<title>{{title}}</title>
</head>
<style>

html { width: 100%; height:100%; overflow:hidden; }

body{
    margin: 0;
    padding: 0;
    font-family: sans-serif;
    background: #092756;
    background: linear-gradient(#8b9da9, #fff6e4);
}

.clearfix:after {
    content: '';
    visibility: hidden;
    display: block;
    clear: both;
    height: 0;
}

.user-pict {
    float: left;
}

.user-info {
    float: left;
    min-width: 350px;
    margin-left: 20px;
}

.main-div {
    margin-bottom: 20px;
    margin-left: 70px;
}

.main-div:last-child {
    margin-bottom: 0;
}

.main-div:first-child {
    margin-top: 40px;
}

h2 {
    margin-left: 30px;
}

button {
    width: 100px;
    height: 25px;
    font-size: 18px;
    border: none;
    color: white;
}

#red {
    background-color: darkred;
}

#green {
    background-color: darkgreen;
}

</style>

<body>
	<h2>Approve or Deny Applications</h2>
    <div class="users-wrapper">
        {{#each users}}	
            <div class="main-div  clearfix" data-user-id={{this.id}}>
                <div class="user-pict">
                    <img height="100" width="100" src="images/{{this.image_name}}">
                </div>
                <div class="user-info">
                    Name: {{this.first_name}} {{this.last_name}}
                    </br>
                    Email: {{this.email}}	
                    </br>
                    Reason: {{this.whyOU}}
                </div>
                <div class="buttons-wrapper"> 
                    <button class="approve-button" id="green" data-id={{this.id}}>Approve</button>
                    <button class="deny-button" id="red" data-id={{this.id}} data-action="deny">Deny</button>
                </div>
            </div>		
        {{/each}}
    </div>
</body>
<script>
    var usersWrappers = document.querySelector(".users-wrapper");

    usersWrappers.addEventListener("click", handler);

    function handler(event) {
        var target = event.target;
        if (target.getAttribute("data-action") === "deny") {
            denyHandler(target, this);
            return;
        }
        approveHandler(target, this);
    }

    function denyHandler(target, parent) {
        var userId = target.getAttribute("data-id");
        fetch(`/applications/${userId}`, {
            method: "delete"
        })
        .then(response => {
            parent.querySelector(`div[data-user-id="${userId}"]`).remove(); 
            alert("Applicant was removed!") 
        })
        .catch((err) => {
            console.log(err.message);
        })  
    }

    function approveHandler(target, parent) {
        var userId = target.getAttribute("data-id");
        fetch(`/applications/${userId}`, {
            method: "get"
        })
        .then(response => {
            parent.querySelector(`div[data-user-id="${userId}"]`).remove(); 
            alert("Applicant was added!")  
        })
        .catch((err) => {
            console.log(err.message);
        })  
    }

</script>
</html>
